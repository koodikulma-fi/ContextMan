function t(t){if(t.constructor===Object)return t;const e={};for(const s of t)e[s]=!0;return e}function e(t,e,s,n){null!==e&&void 0!==n&&(clearTimeout(e),e=null);const i=void 0!==n?n:s;return null===i?t():null===e&&(e=setTimeout((()=>t()),i)),e}function s(t,e,s=1){(!s||s<0)&&(s=1),null==e&&([e,t]=[t,0]);const n=[];if(e<t)for(let i=t-1;i>=e;i-=s)n.push(i);else for(let i=t;i<e;i+=s)n.push(i);return n}function n(t,e,s=-1){if(t===e)return!0;if(t&&s&&'object'==typeof t){if(!e||'object'!=typeof e)return!1;const i=t.constructor;if(i!==e.constructor)return!1;s--;let r=!1;switch(i){case Object:break;case Array:r=!0;break;case Set:r=!0,t=[...t],e=[...e];break;case Map:if(t.size!==e.size)return!1;for(const[i,r]of t){if(!e.has(i))return!1;if(s?!n(e.get(i),r,s):e.get(i)!==r)return!1}return!0;default:const i=t.toString();'[object NodeList]'!==i&&'[object HTMLCollection]'!==i||(r=!0)}if(r){const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(s?!n(t[r],e[r],s):t[r]!==e[r])return!1}else{for(const i in e){if(!t.hasOwnProperty(i))return!1;if(s?!n(t[i],e[i],s):t[i]!==e[i])return!1}for(const s in t)if(!e.hasOwnProperty(s))return!1}return!0}return!1}function i(t,e=-1){if(!t||!e||'object'!=typeof t)return t;e--;let s=null;switch(t.constructor){case Object:break;case Array:s=t;break;case Set:return new Set(e?[...t].map((t=>i(t,e))):t);case Map:return new Map(e?[...t].map((([t,s])=>[i(t,e),i(s,e)])):t);default:const n=t.toString();'[object NodeList]'!==n&&'[object HTMLCollection]'!==n||(s=[...t])}if(s)return e?s.map((t=>i(t,e))):[...s];if(!e)return Object.assign({},t);const n=new t.constructor;for(const s in t)n[s]=i(t[s],e);return n}var r,o;function a(t,e,s=1){const i='string'==typeof s?r[s]:s;let o;return(s,r=!1,a)=>{const c=e;if(i<-1){if(-2!==i)return!1}else if(!r&&n(c,s,i))return!1;return void 0!==a&&(o&&o(c,s),o=void 0,t=a||void 0),e=s,t&&(o=t(s,c)||void 0),!1}}function c(t,e=0){let s,i;const o='string'==typeof e?r[e]:e;return(...e)=>{if(i)if(o<-1){if(-2!==o)return s}else if(n(i,e,o>=0?o+1:o))return s;return i=e,s=t(...e),s}}function l(t,e,s=0){let i,o;const a='string'==typeof s?r[s]:s;return(...s)=>{const r=t(...s);if(i)if(a<-1){if(-2!==a)return o}else if(n(r,i,a))return o;return i=r,o=e(...i),o}}function f(t,e,s,n=0){const i={};return(...r)=>{const o=s(...r,i);return i[o]||(i[o]=l(t,e,n)),i[o](...r)}}function h(t,e){for(const s of t.slice()){const n=s[2]||0;if(n&o.OneShot){const e=s[4]||t,n=e.indexOf(s);-1!==n&&e.splice(n,1)}n&o.Deferred?setTimeout((()=>s[0](...s[1]&&e?[...e,...s[1]]:e||s[1]||[])),0):s[0](...s[1]&&e?[...e,...s[1]]:e||s[1]||[])}}function u(t,e,s){const n=s&&(s.includes('first')||s.includes('first-true')),i=s&&(n||s.includes('last')),r=s&&s.includes('no-false'),a=s&&s.includes('no-null');let c=[];for(const l of t.slice()){const f=l[2]||0;if(f&o.OneShot){const e=l[4]||t,s=e.indexOf(l);-1!==s&&e.splice(s,1)}if(f&o.Deferred)setTimeout((()=>l[0](...l[1]&&e?[...e,...l[1]]:e||l[1]||[])),0);else{const t=l[0](...l[1]&&e?[...e,...l[1]]:e||l[1]||[]);if(!t&&(void 0===t||r||a&&null==t))continue;if(i?c[0]=t:c.push(t),n&&(t||!s.includes('first-true')))break}}return i?c[0]:c}function d(t){return class extends t{constructor(...t){super(...t),this.signals={}}listenTo(t,e,s,n=o.None,i){let r=this.signals[t];const a=[e,s||null,n||o.None,null!=i?i:null];r?r.some(((t,s)=>t[0]===e&&(r[s]=a)))||r.push(a):this.signals[t]=r=[a],a[2]&o.OneShot&&a.push(r),this.onListener(t,r.indexOf(a),!0)}unlistenTo(t,e,s){null==t?t=Object.keys(this.signals):'string'==typeof t&&(t=[t]);const n=null!=s;for(const i of t){const t=this.signals[i];if(t){for(let r=t.length-1;r>=0;r--)e&&t[r][0]!==e||n&&t[r][3]!==s||(this.onListener(i,r,!1),t.splice(r,1));t[0]||delete this.signals[i]}}}isListening(t,e,s){return null==t?Object.keys(this.signals).some((t=>this.isListening(t,e,s))):!!this.signals[t]&&(!(e&&!this.signals[t].some((t=>t[0]===e)))&&!(null!=s&&!this.signals[t].some((t=>t[3]===s))))}sendSignal(t,...e){const s=this.getListenersFor?this.getListenersFor(t):this.signals[t];s&&h(s,e)}sendSignalAs(t,e,...s){const n='string'==typeof t?[t]:t,i=n.includes('delay')||n.includes('pre-delay'),r=n.includes('first')||n.includes('first-true'),o=n.includes('multi')||!r&&!n.includes('last');if(n.includes('await'))return new Promise((async t=>{i&&await this.afterRefresh(n.includes('delay'));const a=this.getListenersFor?this.getListenersFor(e):this.signals[e];if(!a)return t(o?[]:void 0);let c=(await Promise.all(u(a,s))).filter((t=>!(void 0===t||null==t&&n.includes('no-null')||!t&&n.includes('no-false'))));r&&n.includes('first-true')&&(c=c.filter((t=>t)));const l=c.length;l?r?t(o?[c[0]]:c[0]):n.includes('last')?t(o?[c[l-1]]:c[l-1]):t(c):t(o?[]:void 0)}));if(!i){const t=this.getListenersFor?this.getListenersFor(e):this.signals[e];return t?u(t,s,n):n.includes('last')||r?void 0:[]}(async()=>{await this.afterRefresh(n.includes('delay'));const t=this.getListenersFor?this.getListenersFor(e):this.signals[e];t&&(r?u(t,s,n):h(t,s))})()}afterRefresh(t=!1){return new Promise((e=>setTimeout(t?async()=>{await this.awaitRefresh(),e()}:e,0)))}awaitRefresh(){return new Promise((t=>setTimeout(t,1)))}onListener(t,e,s){}}}(t=>{t[t.never=-3]='never',t[t.always=-2]='always',t[t.deep=-1]='deep',t[t.changed=0]='changed',t[t.shallow=1]='shallow',t[t.double=2]='double'})(r||(r={})),(t=>{t[t.OneShot=1]='OneShot',t[t.Deferred=2]='Deferred',t[t.None=0]='None',t[t.All=3]='All'})(o||(o={}));const g=d;class y extends(d(Object)){}function p(t){return class extends t{constructor(){super(...arguments),this.dataListeners=new Map}listenToData(...t){var e;let s=1;const n=t.length,i='boolean'==typeof t[n-s]&&t[n-s++],r='object'==typeof t[0],o=r?t[0]:Array.isArray(t[n-s])?null===(e=t[n-s++])||void 0===e?void 0:e.slice():void 0,a=r?Object.keys(t[0]):t.slice(0,n-s),c=t[n-s];this.dataListeners.set(c,[o,...a]),i&&c(...this.getDataArgsBy(a,o))}unlistenToData(t){return!!this.dataListeners.has(t)&&(this.dataListeners.delete(t),!0)}getInData(t,e){}setInData(t,e,s,n){}getDataArgsBy(t,e){return e?Array.isArray(e)?t.map(((t,s)=>this.getInData(t,e[s]))):[t.reduce(((t,s)=>(t[s]=this.getInData(s,e[s]),t)),{})]:t.map(((t,e)=>this.getInData(t)))}callDataBy(t=!0){for(const[e,[s,...n]]of this.dataListeners.entries())(!0===t||t.some((t=>n.some((e=>e===t||e.startsWith(t+'.')||t.startsWith(e+'.'))))))&&e(...this.getDataArgsBy(n,s))}}}const x=p;class b extends(p(Object)){}var O=(t,e)=>{var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&'function'==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]])}return s};function D(t){return class extends(x(t)){constructor(...t){super(...t.slice(1)),this.dataListeners=new Map,this.dataKeysPending=null,this.data=t[0]||{}}getData(){return this.data}getInData(t,e){if(!this.data)return e;if(!t)return this.data;const s=t.split('.');let n=this.data;for(const t of s){if(!n)return e;n=n[t]}return void 0===n?e:n}setData(t,e=!0,s=!0,n){this.data=!1!==e?Object.assign(Object.assign({},this.data),t):t,s?this.refreshData(!0,n):this.addRefreshKeys(!0)}setInData(t,e,s=!0,n=!0,i){var r,o,a;if(this.data){if(t){const n=t.split('.'),i=n.pop();if(!i)return;let c=(r=this.data,this.data=O(r,[]),r);for(const t of n)c=c[t]=(null===(o=c[t])||void 0===o?void 0:o.constructor)===Object?Object.assign({},c[t]):c[t]||{};c[i]=s&&(null===(a=c[i])||void 0===a?void 0:a.constructor)===Object?Object.assign(Object.assign({},c[i]),e):e}else this.data=s&&this.data?Object.assign(Object.assign({},this.data),e):e;n?this.refreshData(t||!0,i):this.addRefreshKeys(t||!0)}}refreshData(t,e){if(t&&this.addRefreshKeys(t),null!=e)return void setTimeout((()=>this.refreshData(null)),e);const s=this.dataKeysPending;this.dataKeysPending=null,s&&this.callDataBy(s)}addRefreshKeys(t){if(!0===t)this.dataKeysPending=!0;else if(t&&!0!==this.dataKeysPending)if('string'==typeof t&&(t=[t]),this.dataKeysPending)for(const e of t)this.dataKeysPending.some((t=>t===e||e.startsWith(t+'.')))||this.dataKeysPending.push(e);else this.dataKeysPending=[...t]}}}const P=D;class m extends(D(Object)){constructor(...t){super(...t)}}function v(t){return class extends(x(g(t))){}}const w=v;class j extends(v(Object)){}function L(t){return class extends(P(g(t))){}}const A=L;class R extends(L(Object)){}class S extends R{constructor(t,e){super(t),this.contextAPIs=new Map,this.settings=this.constructor.getDefaultSettings(),this._refreshTimer=null,e&&this.modifySettings(e)}modifySettings(t){var e;const s=this.constructor.getDefaultSettings();for(const n in t)this.settings[n]=void 0!==t[n]?t[n]:null!==(e=this.settings[n])&&void 0!==e?e:s[n]}getListenersFor(t){let e=this.signals[t]||[];for(const[s,n]of this.contextAPIs)for(const i of n){const n=s.getListenersFor?s.getListenersFor(i+'.'+t):s.signals[i+'.'+t];n&&(e=e.concat(n))}return e[0]&&e}afterRefresh(t=!1,e){return new Promise((async s=>{const n=t?'_afterPost':'_afterPre';this[n]||(this[n]=[]),this[n].push((()=>s())),this.triggerRefresh(e)}))}async awaitRefresh(){const t=[];for(const e of this.contextAPIs.keys())t.push(e.afterRefresh(!0));await Promise.all(t)}refreshData(t,e){t&&this.addRefreshKeys(t),this.triggerRefresh(e)}triggerRefresh(t){this._refreshTimer=e((()=>this.refreshPending()),this._refreshTimer,this.settings.refreshTimeout,t)}isWaitingForRefresh(){return null!==this._refreshTimer}isPendingRefresh(){return!!(this._afterPre||this._afterPost||this.dataKeysPending)}refreshPending(){const t=this.dataKeysPending;let e=this._afterPre,s=this._afterPost;if(this._refreshTimer=null,this.dataKeysPending=null,delete this._afterPre,delete this._afterPost,e)for(const t of e)t();if(t){for(const[e,[s,...n]]of this.dataListeners.entries())(!0===t||t.some((t=>n.some((e=>e===t||e.startsWith(t+'.')||t.startsWith(e+'.'))))))&&e(...this.getDataArgsBy(n,s));for(const[e,s]of this.contextAPIs.entries())e.callDataListenersFor?e.callDataListenersFor(s,t):e.callDataBy(!0===t?s:s.map((e=>t.map((t=>e+'.'+t)))).reduce(((t,e)=>t.concat(e))))}s&&(async()=>{await this.awaitRefresh();for(const t of s)t()})()}static getDefaultSettings(){return{refreshTimeout:0}}}class I extends j{constructor(t){super(),this.contexts=Object.assign({},t),this.dataListeners=new Map}afterRefresh(t=!1,e){return this.awaitRefresh()}awaitRefresh(){return new Promise((async t=>t()))}sendSignal(t,...e){var s;const n=t.indexOf('.');-1!==n&&(null===(s=this.getContext(t.slice(0,n)))||void 0===s||s.sendSignal(t.slice(n+1),...e))}sendSignalAs(t,e,...s){const n=e.indexOf('.'),i=-1===n?null:this.getContext(e.slice(0,n));if(i)return i.sendSignalAs(t,e.slice(n+1),...s);const r='string'==typeof t?[t]:t,o=r.includes('last')||r.includes('first')||r.includes('first-true')?void 0:[];return r.includes('await')?new Promise((t=>t(o))):o}getInData(t,e=void 0){const s=t.indexOf('.'),n=this.getContext(-1===s?t:t.slice(0,s));return n?-1!==s?n.getInData(t.slice(s+1),e):n.getData():e}setInData(t,e,s,n,i){const r=t.indexOf('.'),o=this.getContext(-1===r?t:t.slice(0,r));o&&(-1!==r?o.setInData(t.slice(r+1),e,s,n,i):o.setData(e,s,n,i))}refreshData(t,e){var s,n;const i={};for(const e of'string'==typeof t?[t]:t){const t=e.indexOf('.'),n=-1===t?e:e.slice(0,t);void 0!==i[n]&&(i[n]=this.getContext(n)),null===(s=i[n])||void 0===s||s.addRefreshKeys(-1===t||e.slice(n.length+1))}for(const t in i)null===(n=i[t])||void 0===n||n.refreshData(null,e)}refreshDataBy(t,e){const s=this.getContexts(t);for(const n in s){const i=s[n];i&&i.refreshData(t[n],e)}}getContext(t){return this.contexts[t]}getContexts(e,s=!1){if(!e)return Object.assign({},this.contexts);const n=t(e),i={};for(const t in this.contexts)!n[t]||void 0===this.contexts[t]||s&&null===this.contexts[t]||(i[t]=this.contexts[t]);return i}newContext(t,e,s=!0){const n=new S(t);return e&&this.setContext(e,n,s),n}newContexts(t,e=!1,s=!0){const n={};for(const e in t)n[e]=new S(t[e]);return e&&this.setContexts(n,s),n}setContext(t,e,s=!0){const n=this.contexts[t];if(n===e)return!1;if(n){const e=n.contextAPIs.get(this);if(e){const s=e.filter((e=>e!==t));s.length?n.contextAPIs.set(this,s):n.contextAPIs.delete(this)}}if(e){const s=e.contextAPIs.get(this)||[];s.includes(t)||s.push(t),e.contextAPIs.set(this,s)}return void 0!==e?this.contexts[t]=e:delete this.contexts[t],s&&(this.callDataListenersFor?this.callDataListenersFor([t]):this.callDataBy([t])),!0}setContexts(t,e=!0){let s=!1;for(const e in t)s=this.setContext(e,t[e],!1)||s;return e&&s&&(this.callDataListenersFor?this.callDataListenersFor(Object.keys(t)):this.callDataBy(Object.keys(t))),s}}export{r as CompareDataDepthEnum,S as Context,I as ContextAPI,b as DataBoy,x as DataBoyMixin,m as DataMan,P as DataManMixin,j as SignalDataBoy,w as SignalDataBoyMixin,R as SignalDataMan,A as SignalDataManMixin,o as SignalListenerFlags,y as SignalMan,g as SignalManMixin,D as _DataManMixin,d as _SignalManMixin,n as areEqual,u as askListeners,t as buildRecordable,h as callListeners,f as createCachedSource,c as createDataMemo,l as createDataSource,a as createDataTrigger,s as createRange,i as deepCopy,e as updateCallTimer};
