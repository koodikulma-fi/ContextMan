function t(t,e,s,n){null!==e&&void 0!==n&&(clearTimeout(e),e=null);const r=void 0!==n?n:s;return null===r?t():null===e&&(e=setTimeout((()=>t()),r)),e}function e(t,s,n=-1){if(t===s)return!0;if(t&&n&&'object'==typeof t){if(!s||'object'!=typeof s)return!1;const r=t.constructor;if(r!==s.constructor)return!1;n--;let i=!1;switch(r){case Object:break;case Array:i=!0;break;case Set:i=!0,t=[...t],s=[...s];break;case Map:if(t.size!==s.size)return!1;for(const[r,i]of t){if(!s.has(r))return!1;if(n?!e(s.get(r),i,n):s.get(r)!==i)return!1}return!0;default:const r=t.toString();'[object NodeList]'!==r&&'[object HTMLCollection]'!==r||(i=!0)}if(i){const r=t.length;if(r!==s.length)return!1;for(let i=0;i<r;i++)if(n?!e(t[i],s[i],n):t[i]!==s[i])return!1}else{for(const r in s){if(!t.hasOwnProperty(r))return!1;if(n?!e(t[r],s[r],n):t[r]!==s[r])return!1}for(const e in t)if(!s.hasOwnProperty(e))return!1}return!0}return!1}var s,n;function r(t,s,n=1){let r,i=[];const o='string'==typeof n?exports.CompareDataDepthEnum[n]:n;return(...n)=>{const a=t(...n);if(o<-1){if(-2!==o)return r}else if(e(a,i,o))return r;return i=a,r=s(...i),r}}function i(t,e){for(const s of t.slice()){const n=s[2]||0;if(n&exports.SignalListenerFlags.OneShot){const e=s[4]||t,n=e.indexOf(s);-1!==n&&e.splice(n,1)}n&exports.SignalListenerFlags.Deferred?setTimeout((()=>s[0](...s[1]&&e?[...e,...s[1]]:e||s[1]||[])),0):s[0](...s[1]&&e?[...e,...s[1]]:e||s[1]||[])}}function o(t,e,s){const n=s&&(s.includes('first')||s.includes('first-true')),r=s&&(n||s.includes('last')),i=s&&s.includes('no-false'),o=s&&s.includes('no-null');let a=[];for(const l of t.slice()){const c=l[2]||0;if(c&exports.SignalListenerFlags.OneShot){const e=l[4]||t,s=e.indexOf(l);-1!==s&&e.splice(s,1)}if(c&exports.SignalListenerFlags.Deferred)setTimeout((()=>l[0](...l[1]&&e?[...e,...l[1]]:e||l[1]||[])),0);else{const t=l[0](...l[1]&&e?[...e,...l[1]]:e||l[1]||[]);if(!t&&(void 0===t||i||o&&null==t))continue;if(r?a[0]=t:a.push(t),n&&(t||!s.includes('first-true')))break}}return r?a[0]:a}function a(t){return class extends t{constructor(...t){super(...t),this.signals={}}listenTo(t,e,s,n=exports.SignalListenerFlags.None,r){let i=this.signals[t];const o=[e,s||null,n||exports.SignalListenerFlags.None,null!=r?r:null];i?i.some(((t,s)=>t[0]===e&&(i[s]=o)))||i.push(o):this.signals[t]=i=[o],o[2]&exports.SignalListenerFlags.OneShot&&o.push(i),this.onListener&&this.onListener(t,i.indexOf(o),!0)}unlistenTo(t,e,s){null==t?t=Object.keys(this.signals):'string'==typeof t&&(t=[t]);const n=null!=s;for(const r of t){const t=this.signals[r];if(t){for(let i=t.length-1;i>=0;i--)e&&t[i][0]!==e||n&&t[i][3]!==s||(this.onListener&&this.onListener(r,i,!1),t.splice(i,1));t[0]||delete this.signals[r]}}}isListening(t,e,s){return null==t?Object.keys(this.signals).some((t=>this.isListening(t,e,s))):!!this.signals[t]&&(!(e&&!this.signals[t].some((t=>t[0]===e)))&&!(null!=s&&!this.signals[t].some((t=>t[3]===s))))}sendSignal(t,...e){const s=this.getListenersFor?this.getListenersFor(t):this.signals[t];s&&i(s,e)}sendSignalAs(t,e,...s){const n='string'==typeof t?[t]:t,r=n.includes('delay')||n.includes('pre-delay'),a=n.includes('first')||n.includes('first-true'),l=n.includes('multi')||!a&&!n.includes('last');if(n.includes('await'))return new Promise((async t=>{r&&await this.afterRefresh(n.includes('delay'));const i=this.getListenersFor?this.getListenersFor(e):this.signals[e];if(!i)return t(l?[]:void 0);let c=(await Promise.all(o(i,s))).filter((t=>!(void 0===t||null==t&&n.includes('no-null')||!t&&n.includes('no-false'))));a&&n.includes('first-true')&&(c=c.filter((t=>t)));const u=c.length;u?a?t(l?[c[0]]:c[0]):n.includes('last')?t(l?[c[u-1]]:c[u-1]):t(c):t(l?[]:void 0)}));if(!r){const t=this.getListenersFor?this.getListenersFor(e):this.signals[e];return t?o(t,s,n):n.includes('last')||a?void 0:[]}(async()=>{await this.afterRefresh(n.includes('delay'));const t=this.getListenersFor?this.getListenersFor(e):this.signals[e];t&&(a?o(t,s,n):i(t,s))})()}afterRefresh(t=!1){return new Promise((e=>setTimeout(e,t?1:0)))}}}Object.defineProperty(exports,'__esModule',{value:!0}),exports.CompareDataDepthEnum=void 0,(s=exports.CompareDataDepthEnum||(exports.CompareDataDepthEnum={}))[s.never=-3]='never',s[s.always=-2]='always',s[s.deep=-1]='deep',s[s.changed=0]='changed',s[s.shallow=1]='shallow',s[s.double=2]='double',exports.SignalListenerFlags=void 0,(n=exports.SignalListenerFlags||(exports.SignalListenerFlags={}))[n.OneShot=1]='OneShot',n[n.Deferred=2]='Deferred',n[n.None=0]='None',n[n.All=3]='All';const l=a;class c extends(a(Object)){}function u(t){return class extends t{constructor(){super(...arguments),this.dataListeners=new Map}listenToData(...t){var e;let s=1;const n=t.length,r='boolean'==typeof t[n-s]&&t[n-s++],i='object'==typeof t[0],o=i?Object.values(t[0]):Array.isArray(t[n-s])?null===(e=t[n-s++])||void 0===e?void 0:e.slice():void 0,a=i?Object.keys(t[0]):t.slice(0,n-s),l=t[n-s];this.dataListeners.set(l,[o,...a]),r&&l(...this.getDataArgsBy(a,o))}unlistenToData(t){return!!this.dataListeners.has(t)&&(this.dataListeners.delete(t),!0)}getInData(t,e){}setInData(t,e,s=!1,n=!0,...r){}getDataArgsBy(t,e){return e?t.map(((t,s)=>this.getInData(t,e[s]))):t.map(((t,e)=>this.getInData(t)))}callDataBy(t=!0){for(const[e,[s,...n]]of this.dataListeners.entries())(!0===t||t.some((t=>n.some((e=>e===t||e.startsWith(t+'.')||t.startsWith(e+'.'))))))&&e(...this.getDataArgsBy(n,s))}}}const h=u;class f extends(u(Object)){}var d=(t,e)=>{var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&'function'==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(s[n[r]]=t[n[r]])}return s};function g(t){return class extends(h(t)){constructor(...t){super(...t.slice(1)),this.dataListeners=new Map,this.dataKeysPending=null,this.data=t[0]||{}}getData(){return this.data}getInData(t,e){if(!this.data)return e;if(!t)return this.data;const s=t.split('.');let n=this.data;for(const t of s){if(!n)return e;n=n[t]}return void 0===n?e:n}setData(t,e=!0,s=!0,...n){this.data=!1!==e?Object.assign(Object.assign({},this.data),t):t,s?this.refreshData(!0,...n):this.addRefreshKeys(!0)}setInData(t,e,s=!0,n=!0,...r){var i,o,a;if(this.data){if(t){const n=t.split('.'),r=n.pop();if(!r)return;let l=(i=this.data,this.data=d(i,[]),i);for(const t of n)l=l[t]=(null===(o=l[t])||void 0===o?void 0:o.constructor)===Object?Object.assign({},l[t]):l[t]||{};l[r]=s&&(null===(a=l[r])||void 0===a?void 0:a.constructor)===Object?Object.assign(Object.assign({},l[r]),e):e}else this.data=s&&this.data?Object.assign(Object.assign({},this.data),e):e;n?this.refreshData(t||!0,...r):this.addRefreshKeys(t||!0)}}refreshData(t,e){if(t&&this.addRefreshKeys(t),null!=e)return void setTimeout((()=>this.refreshData(null)),e);const s=this.dataKeysPending;this.dataKeysPending=null,s&&this.callDataBy(s)}addRefreshKeys(t){if(!0===t)this.dataKeysPending=!0;else if(t&&!0!==this.dataKeysPending)if('string'==typeof t&&(t=[t]),this.dataKeysPending)for(const e of t)this.dataKeysPending.some((t=>t===e||e.startsWith(t+'.')))||this.dataKeysPending.push(e);else this.dataKeysPending=[...t]}}}const p=g;class x extends(g(Object)){constructor(...t){super(...t)}}function y(t){return class extends(h(l(t))){}}const D=y;class m extends(y(Object)){}function b(t){return class extends(p(l(t))){}}const v=b;class L extends(b(Object)){}class O extends L{constructor(t,e){super(t),this.contextAPIs=new Map,this.settings=this.constructor.getDefaultSettings(),this._refreshTimer=null,e&&this.modifySettings(e)}getListenersFor(t){let e=this.signals[t]||[];for(const[s,n]of this.contextAPIs)for(const r of n){const n=s.getListenersFor?s.getListenersFor(r+'.'+t):s.signals[r+'.'+t];n&&(e=e.concat(n))}return e[0]&&e}afterRefresh(t=!1,e){return new Promise((async s=>{const n=t?'_afterPost':'_afterPre';this[n]||(this[n]=[]),this[n].push((()=>s())),this.triggerRefresh(e)}))}refreshData(t,e){t&&this.addRefreshKeys(t),this.triggerRefresh(e)}triggerRefresh(e){this._refreshTimer=t((()=>this.refreshPending()),this._refreshTimer,this.settings.refreshTimeout,e)}isWaitingForRefresh(){return null!==this._refreshTimer}refreshPending(){const t=this.dataKeysPending;let e=this._afterPre,s=this._afterPost;if(this._refreshTimer=null,this.dataKeysPending=null,delete this._afterPre,delete this._afterPost,e)for(const t of e)t();if(t){for(const[e,[s,...n]]of this.dataListeners.entries())(!0===t||t.some((t=>n.some((e=>e===t||e.startsWith(t+'.')||t.startsWith(e+'.'))))))&&e(...this.getDataArgsBy(n,s));for(const[e,s]of this.contextAPIs.entries())e.callDataListenersFor?e.callDataListenersFor(s,t):e.callDataBy(!0===t?s:s.map((e=>t.map((t=>e+'.'+t)))).reduce(((t,e)=>t.concat(e))))}s&&(async()=>{const t=[];for(const e of this.contextAPIs.keys())t.push(e.afterRefresh(!0));await Promise.all(t);for(const t of s)t()})()}modifySettings(t){const e=this.constructor.getDefaultSettings();for(const s in t)this.settings[s]=void 0===t[s]?e[s]:t[s]}static getDefaultSettings(){return{refreshTimeout:0}}}function P(t){if(t.constructor===Object)return t;const e={};for(const s of t)e[s]=!0;return e}exports.Context=O,exports.ContextAPI=class extends m{constructor(t){super(),this.contexts=Object.assign({},t),this.dataListeners=new Map}afterRefresh(t=!1,e){return new Promise((async t=>t()))}sendSignal(t,...e){var s;const[n,r]=t.split('.',2);return null===(s=this.getContext(n))||void 0===s?void 0:s.sendSignal(r,...e)}sendSignalAs(t,e,...s){const[n,r]=e.split('.',2),i=this.getContext(n);if(i)return i.sendSignalAs(t,r,...s);const o='string'==typeof t?[t]:t,a=o.includes('last')||o.includes('first')||o.includes('first-true')?void 0:[];return o.includes('await')?new Promise((t=>t(a))):a}getInData(t,e=void 0){const s=t.split('.',1)[0],n=t.slice(s.length+1),r=this.getContext(s);return r?n?r.getInData(n,e):r.getData():e}setInData(t,e,s,n,r){var i,o;const a=t.split('.',1)[0],l=t.slice(a.length+1);l?null===(i=this.getContext(a))||void 0===i||i.setInData(l,e,s,n,r):null===(o=this.getContext(a))||void 0===o||o.setData(e,s,n,r)}refreshData(t,e){var s,n;const r={};for(const e of'string'==typeof t?[t]:t){const t=e.split('.',1)[0];void 0!==r[t]&&(r[t]=this.getContext(t)),null===(s=r[t])||void 0===s||s.addRefreshKeys(e.slice(t.length+1))}for(const t in r)null===(n=r[t])||void 0===n||n.refreshData(null,e)}refreshDataBy(t,e){const s=this.getContexts(t);for(const n in s){const r=s[n];r&&r.refreshData(t[n],e)}}getContext(t){return this.contexts[t]}getContexts(t){if(!t)return Object.assign({},this.contexts);const e=P(t),s={};for(const t in this.contexts)e[t]&&(s[t]=this.contexts[t]);return s}newContext(t,e,s=!0){const n=new O(t);return e&&this.setContext(e,n,s),n}newContexts(t,e=!1,s=!0){const n={};for(const e in t)n[e]=new O(t[e]);return e&&this.setContexts(n,s),n}setContext(t,e,s=!0){const n=this.contexts[t];if(n===e)return!1;if(n){const e=n.contextAPIs.get(this);if(e){const s=e.filter((e=>e!==t));s.length?n.contextAPIs.set(this,s):n.contextAPIs.delete(this)}}if(e){const s=e.contextAPIs.get(this)||[];s.includes(t)||s.push(t),e.contextAPIs.set(this,s)}return void 0!==e?this.contexts[t]=e:delete this.contexts[t],s&&(this.callDataListenersFor?this.callDataListenersFor([t]):this.callDataBy([t])),!0}setContexts(t,e=!0){let s=!1;for(const e in t)s=this.setContext(e,t[e],!1)||s;return e&&s&&(this.callDataListenersFor?this.callDataListenersFor(Object.keys(t)):this.callDataBy(Object.keys(t))),s}getDataArgsBy(t,e){return t.map(((t,s)=>{const n=t.split('.',1)[0],r=this.getContext(n),i=t.slice(n.length+1);return r?i?r.getInData(i,e&&e[s]):r.getData():e&&e[s]}))}},exports.DataBoy=f,exports.DataBoyMixin=h,exports.DataMan=x,exports.DataManMixin=p,exports.SignalDataBoy=m,exports.SignalDataBoyMixin=D,exports.SignalDataMan=L,exports.SignalDataManMixin=v,exports.SignalMan=c,exports.SignalManMixin=l,exports._DataManMixin=g,exports._SignalManMixin=a,exports.areEqual=e,exports.askListeners=o,exports.buildRecordable=P,exports.callListeners=i,exports.callWithTimeout=t,exports.createDataMemo=function(t,s=1){let n,r;const i='string'==typeof s?exports.CompareDataDepthEnum[s]:s;return(...s)=>{if(r)if(i<-1){if(-2!==i)return n}else if(e(r,s,i>=0?i+1:i))return n;return r=s,n=t(...s),n}},exports.createDataPicker=r,exports.createDataSelector=function(t,e,s=1){return r(((...e)=>t.map((t=>t&&t(...e)))),e,s)},exports.createDataTrigger=function(t,s,n=1){const r='string'==typeof n?exports.CompareDataDepthEnum[n]:n;let i;return(n,o=!1,a)=>{const l=s;if(r<-1){if(-2!==r)return!1}else if(!o&&e(l,n,r))return!1;return void 0!==a&&(i&&i(l,n),i=void 0,t=a||void 0),s=n,t&&(i=t(n,l)||void 0),!1}},exports.deepCopy=function t(e,s=-1){if(!e||!s||'object'!=typeof e)return e;s--;let n=null;switch(e.constructor){case Object:break;case Array:n=e;break;case Set:return new Set(s?[...e].map((e=>t(e,s))):e);case Map:return new Map(s?[...e].map((([e,n])=>[t(e,s),t(n,s)])):e);default:const r=e.toString();'[object NodeList]'!==r&&'[object HTMLCollection]'!==r||(n=[...e])}if(n)return s?n.map((e=>t(e,s))):[...n];if(!s)return Object.assign({},e);const r=new e.constructor;for(const n in e)r[n]=t(e[n],s);return r};
